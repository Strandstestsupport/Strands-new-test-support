<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Strands â€” FAQ Assistant</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #0a0a0a;
    --surface: #111111;
    --surface2: #1a1a1a;
    --border: #2a2a2a;
    --accent: #f5c800;
    --accent-dark: #d4a800;
    --accent-glow: rgba(245,200,0,0.15);
    --text: #f0f0f0;
    --muted: #888;
    --bot-bg: #161616;
    --user-bg: #f5c800;
  }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Inter', sans-serif;
    min-height: 100vh;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    padding: 20px;
    background-image:
      radial-gradient(circle at 85% 10%, rgba(245,200,0,0.05) 0%, transparent 45%),
      radial-gradient(circle at 10% 90%, rgba(245,200,0,0.03) 0%, transparent 40%);
  }

  .wrapper { width: 100%; max-width: 740px; }

  .header {
    display: flex; align-items: center; gap: 18px;
    margin-bottom: 22px;
    animation: fadeDown 0.5s ease both;
  }

  .logo-mark {
    width: 56px; height: 56px;
    background: #000;
    border: 2px solid var(--accent);
    border-radius: 14px;
    display: flex; align-items: center; justify-content: center;
    font-family: 'Syne', sans-serif; font-weight: 800; font-size: 12px;
    color: var(--accent);
    flex-shrink: 0;
    box-shadow: 0 0 20px rgba(245,200,0,0.25), 0 4px 14px rgba(0,0,0,0.5);
    letter-spacing: 0.5px;
    line-height: 1.2;
    text-align: center;
  }

  .header-text h1 {
    font-family: 'Syne', sans-serif; font-size: 22px; font-weight: 800;
    color: var(--accent); letter-spacing: 0.3px;
  }
  .header-text p { font-size: 13px; color: var(--muted); margin-top: 3px; font-weight: 300; }

  .status-dot {
    width: 7px; height: 7px; background: #22c55e; border-radius: 50%;
    display: inline-block; margin-right: 5px; animation: pulse 2s infinite;
  }

  .chat-box {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 20px; overflow: hidden;
    box-shadow: 0 8px 60px rgba(0,0,0,0.6), 0 0 0 1px rgba(245,200,0,0.05);
    animation: fadeUp 0.6s ease both 0.1s;
  }

  .messages {
    height: 460px; overflow-y: auto;
    padding: 24px 22px;
    display: flex; flex-direction: column; gap: 14px;
    scroll-behavior: smooth;
  }

  .messages::-webkit-scrollbar { width: 4px; }
  .messages::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 4px; }

  .message { display: flex; gap: 10px; animation: msgIn 0.3s ease both; }
  .message.user { flex-direction: row-reverse; }

  .avatar {
    width: 32px; height: 32px; border-radius: 10px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    font-size: 9px; font-weight: 800; font-family: 'Syne', sans-serif;
    line-height: 1.1; text-align: center;
  }

  .bot-avatar { background: #000; border: 1.5px solid var(--accent); color: var(--accent); box-shadow: 0 0 10px rgba(245,200,0,0.2); }
  .user-avatar { background: #1e1e1e; border: 1px solid #333; color: var(--muted); }

  .bubble {
    max-width: 82%; padding: 12px 16px; border-radius: 14px;
    font-size: 14px; line-height: 1.75;
  }

  .bot .bubble {
    background: var(--bot-bg); border: 1px solid var(--border);
    border-top-left-radius: 4px; color: var(--text);
  }

  .user .bubble {
    background: var(--user-bg);
    border-top-right-radius: 4px; color: #000; font-weight: 500;
  }

  .bubble a { color: var(--accent); text-decoration: underline; }
  .user .bubble a { color: #000; }

  .download-btn {
    display: inline-flex; align-items: center; gap: 6px;
    background: rgba(245,200,0,0.1); border: 1px solid rgba(245,200,0,0.3);
    color: var(--accent); padding: 7px 14px; border-radius: 8px;
    font-size: 12.5px; font-weight: 500; cursor: pointer;
    margin-top: 10px; transition: all 0.2s; text-decoration: none;
  }
  .download-btn:hover { background: rgba(245,200,0,0.2); transform: translateY(-1px); }

  .dots { display: flex; gap: 4px; align-items: center; padding: 4px 2px; }
  .dots span {
    width: 6px; height: 6px; border-radius: 50%;
    background: var(--accent); animation: bounce 1.2s infinite;
  }
  .dots span:nth-child(2) { animation-delay: 0.2s; }
  .dots span:nth-child(3) { animation-delay: 0.4s; }

  .tabs {
    display: flex; gap: 4px; padding: 14px 18px 0;
    border-bottom: 1px solid var(--border);
    overflow-x: auto; scrollbar-width: none;
  }
  .tabs::-webkit-scrollbar { display: none; }

  .tab-btn {
    background: none; border: none; padding: 7px 13px;
    font-family: 'Inter', sans-serif; font-size: 12px; font-weight: 500;
    color: var(--muted); cursor: pointer; border-radius: 8px 8px 0 0;
    white-space: nowrap; transition: all 0.2s;
    border-bottom: 2px solid transparent; margin-bottom: -1px;
  }

  .tab-btn:hover { color: var(--accent); background: var(--accent-glow); }
  .tab-btn.active { color: var(--accent); border-bottom-color: var(--accent); background: var(--accent-glow); }

  .suggestions {
    padding: 12px 20px 14px;
    display: flex; flex-wrap: wrap; gap: 7px;
  }

  .suggestion-btn {
    background: #1a1a1a; border: 1px solid #2a2a2a;
    color: #ccc; font-family: 'Inter', sans-serif;
    font-size: 12px; padding: 6px 13px; border-radius: 20px;
    cursor: pointer; transition: all 0.2s ease;
  }

  .suggestion-btn:hover {
    background: var(--accent-glow); color: var(--accent);
    border-color: rgba(245,200,0,0.4);
    transform: translateY(-1px);
  }

  .input-area {
    display: flex; align-items: center; gap: 10px;
    padding: 14px 18px; border-top: 1px solid var(--border); background: var(--surface2);
  }

  .input-area input {
    flex: 1; background: #0f0f0f; border: 1px solid var(--border);
    border-radius: 10px; padding: 10px 14px; outline: none;
    color: var(--text); font-family: 'Inter', sans-serif; font-size: 14px;
    transition: border-color 0.2s;
  }

  .input-area input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(245,200,0,0.08); }
  .input-area input::placeholder { color: #444; }

  .send-btn {
    width: 40px; height: 40px; border-radius: 10px;
    background: var(--accent); border: none; cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s; flex-shrink: 0;
    box-shadow: 0 2px 12px rgba(245,200,0,0.3);
  }

  .send-btn:hover { background: var(--accent-dark); transform: translateY(-1px); }
  .send-btn svg { width: 16px; height: 16px; fill: #000; }

  .footer {
    display: flex; justify-content: space-between; align-items: center;
    margin-top: 16px; animation: fadeUp 0.6s ease both 0.2s;
  }

  .footer-left { font-size: 12px; color: var(--muted); }
  .footer-left a { color: var(--accent); text-decoration: none; font-weight: 500; }
  .footer-right { font-size: 12px; color: #333; }

  .export-banner {
    background: rgba(245,200,0,0.06); border: 1px solid rgba(245,200,0,0.2);
    border-radius: 10px; padding: 10px 14px; margin-top: 10px;
    font-size: 12.5px; color: #ccc; display: flex; align-items: center; gap: 10px;
    animation: fadeUp 0.4s ease both;
  }
  .export-banner .export-label { color: var(--accent); font-weight: 600; }

  @keyframes fadeDown { from { opacity:0; transform:translateY(-14px); } to { opacity:1; transform:translateY(0); } }
  @keyframes fadeUp { from { opacity:0; transform:translateY(14px); } to { opacity:1; transform:translateY(0); } }
  @keyframes msgIn { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }
  @keyframes bounce { 0%,60%,100% { transform:translateY(0); } 30% { transform:translateY(-5px); } }
  @keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.4; } }
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="logo-mark">STR<br>AND</div>
    <div class="header-text">
      <h1>STRAND Support</h1>
      <p><span class="status-dot"></span>FAQ + Product Assistant Â· Always available Â· No login needed</p>
    </div>
  </div>

  <div class="chat-box">
    <div class="tabs" id="tabs">
      <button class="tab-btn active" onclick="setCategory('all', this)">All Topics</button>
      <button class="tab-btn" onclick="setCategory('product', this)">Products</button>
      <button class="tab-btn" onclick="setCategory('tech', this)">Tech & Facts</button>
      <button class="tab-btn" onclick="setCategory('order', this)">Orders</button>
      <button class="tab-btn" onclick="setCategory('warranty', this)">Warranty</button>
      <button class="tab-btn" onclick="setCategory('canbus', this)">CAN bus & XBB</button>
      <button class="tab-btn" onclick="setCategory('contact', this)">Contact</button>
    </div>

    <div class="messages" id="messages"></div>

    <div class="suggestions" id="suggestions">
      <button class="suggestion-btn" onclick="ask(this)">Tell me about 809456</button>
      <button class="suggestion-btn" onclick="ask(this)">What is lumen and lux?</button>
      <button class="suggestion-btn" onclick="ask(this)">Do I need a CAN bus interface?</button>
      <button class="suggestion-btn" onclick="ask(this)">How long is the warranty?</button>
      <button class="suggestion-btn" onclick="ask(this)">What is IP rating?</button>
      <button class="suggestion-btn" onclick="ask(this)">How do I contact support?</button>
    </div>

    <div class="input-area">
      <input type="text" id="userInput" placeholder="Ask about products, SKUs, tech, orders..." onkeydown="if(event.key==='Enter') sendMessage()" />
      <button class="send-btn" onclick="sendMessage()">
        <svg viewBox="0 0 24 24"><path d="M2 21l21-9L2 3v7l15 2-15 2z"/></svg>
      </button>
    </div>
  </div>

  <div class="footer">
    <div class="footer-left">Powered by <a href="https://strandseurope.com" target="_blank">strandseurope.com</a></div>
    <div class="footer-right">Â© Strands Group AB</div>
  </div>
</div>

<script>
// â”€â”€ PRODUCT DATABASE (from Plytix Export) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PRODUCTS = [{"SKU":"809456XBB","Description 2 (BC)":"White / Amber Pos. | Built-in Relay | XBB Kit","Description EN (BC)":"NUUK D-LINE LPL LED BAR 20\" WITH XBB AND CABLE","Not in use Description SE (BC)":"NUUK D-LINE NUMMERSKYLT LEDRAMP 20\" MED XBB OCH KABEL"},{"SKU":"SLD2015","Description 2 (BC)":"35 - 43","Description EN (BC)":"STRANDS SNEAKERS"},{"SKU":"809456","Description 2 (BC)":"White / Amber Pos. | Built-in Relay | Holder incl.","Description EN (BC)":"NUUK D-LINE LPL LED BAR 20\"","Not in use Description SE (BC)":"NUUK D-LINE NUMMERSKYLT LEDRAMP 20\"","Actual lumen":"9000"},{"SKU":"80916","Description EN (BC)":"SIBERIA OUTLAW LED BAR"},{"SKU":"80917","Description EN (BC)":"SIBERIA SR LED BAR"},{"SKU":"900151","Not in use Description SE (BC)":"P/ FREEDOM Work light 15W"},{"SKU":"905103","Not in use Description SE (BC)":"P/ Duo function warning light"},{"SKU":"906033","Not in use Description SE (BC)":"P/ Scene Work light"},{"SKU":"906032","Not in use Description SE (BC)":"P/ Portable Work light  9W"},{"SKU":"906031","Not in use Description SE (BC)":"P/ Work light 12-80V 9W"},{"SKU":"MAKI18811021M","Description 2 (BC)":"Ford Transit Connect SR (nuuk)  m8","Description EN (BC)":"Installation manual","Not in use Description SE (BC)":"Installasjonsmanual"},{"SKU":"905010","Not in use Description SE (BC)":"P/ New beacon din pole flexi"},{"SKU":"905011","Not in use Description SE (BC)":"P/ New beacon din pole small"},{"SKU":"905008","Not in use Description SE (BC)":"P/ New beacon surface mount"},{"SKU":"907055","Description 2 (BC)":"Fits to Tesla 3/Y  2019-","Description EN (BC)":"STRANDS PRO ADAPTER FOR OBD2-PORT TESLA","Not in use Description SE (BC)":"STRANDS PRO ADAPTER TILL OBD2-PORT TESLA","Actual lumen":"10020","Consumption":"144","1 LUX @ m":"513"},{"SKU":"850251","Description 2 (BC)":"Male and female connector M12","Description EN (BC)":"2 METER CABLE","Not in use Description SE (BC)":"2 METER CABLE RRS","Actual lumen":"6560","1 LUX @ m":"509"},{"SKU":"903034","Not in use Description SE (BC)":"P/ FOR9T Curved silicon pad","Actual lumen":"11000","Consumption":"120","1 LUX @ m":"531"},{"SKU":"901036","Description 2 (BC)":"Fits 901035 | Clear | Stone chip cover","Description EN (BC)":"BIG ENERGY RAW LENS COVER CLEAR FLOOD 9â€³","Not in use Description SE (BC)":"BIG ENERGY RAW LINSSKYDD KLAR FLOOD 9\"","Actual lumen":"8600","Consumption":"110","1 LUX @ m":"769"},{"SKU":"901037","Description 2 (BC)":"Fits 901035 | Yellow | Stone chip cover","Description EN (BC)":"BIG ENERGY RAW LENS COVER YELLOW FLOOD 9â€³","Not in use Description SE (BC)":"BIG ENERGY RAW LINSSKYDD GUL FLOOD 9\"","Actual lumen":"12000"},{"SKU":"906012","Not in use Description SE (BC)":"P/ Thermal plastic rectangular work light"},{"SKU":"906011","Not in use Description SE (BC)":"P/ Thermal plastic sqaure work light"},{"SKU":"MAK52504614A","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"NUUK E-LINE BLACK LED BAR 20\"","Not in use Description SE (BC)":"NUUK E-LINE BLACK LED BAR 20\""},{"SKU":"809214A","Not in use Description SE (BC)":"SIBERIA NG SR LEDRAMP 38\""},{"SKU":"809213A","Not in use Description SE (BC)":"SIBERIA NG SR LEDRAMP 32\""},{"SKU":"809212A","Not in use Description SE (BC)":"SIBERIA NG SR LEDRAMP 20\"","Actual lumen":"13000","Consumption":"12"},{"SKU":"809217A","Description 2 (BC)":"Warning light | Optimized beam","Description EN (BC)":"SIBERIA NG DR LED BAR 22\"","Not in use Description SE (BC)":"SIBERIA NG DR LEDRAMP 22\""},{"SKU":"809216A","Description 2 (BC)":"Warning light | Optimized beam","Description EN (BC)":"SIBERIA NG DR LED BAR 12\"","Not in use Description SE (BC)":"SIBERIA NG DR LEDRAMP 12\""},{"SKU":"270945W","Not in use Description SE (BC)":"IZE LED OG EXTRALJUS 9\""},{"SKU":"907018","Not in use Description SE (BC)":"STRANDS PRO RELAY BOX FOR 4 PORTS 24V"},{"SKU":"MAKI18814421S","Not in use Description SE (BC)":"D-LINE 10\" 3D-PRINT FÃ„STE"},{"SKU":"MAKI18812120S","Not in use Description SE (BC)":"DOBBELRADIG 8\" 3D-PRINT FÃ„STE"},{"SKU":"MAKI18811621S","Not in use Description SE (BC)":"FIREFLY 10\" 3D-PRINT FÃ„STE"},{"SKU":"MAKI18812021S","Description 2 (BC)":"Suitable Ford Transit Connect 2025-","Description EN (BC)":"SINGLE ROW 10\" 3D-PRINT MOUNT","Not in use Description SE (BC)":"ENKELRADIG M8 10\" 3D-PRINT FÃ„STE"},{"SKU":"RRS5250344","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"RRS5250340","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"RRS5250244","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"RRS5250240","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"RRS5250200","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"RRS5250300","Description 2 (BC)":"Suitable KIA PV5","Description EN (BC)":"Cruise Light C-Rack","Not in use Description SE (BC)":"Cruise Light C-Rack"},{"SKU":"270494","Not in use Description SE (BC)":"P/CRUISE LIGHT DYNAMIC TAIL CONTROL"}];

// â”€â”€ UNANSWERED QUESTIONS LOG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let unansweredLog = [];

function logUnanswered(question) {
  unansweredLog.push({ question, timestamp: new Date().toISOString() });
}

function exportUnansweredToExcel() {
  if (unansweredLog.length === 0) {
    addMessage('bot', 'ğŸ“‹ No unanswered questions to export yet!');
    return;
  }
  const ws = XLSX.utils.json_to_sheet(unansweredLog.map(r => ({
    'Question': r.question,
    'Timestamp': r.timestamp
  })));
  ws['!cols'] = [{ wch: 60 }, { wch: 25 }];
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Unanswered Questions');
  XLSX.writeFile(wb, 'strand_unanswered_questions.xlsx');
}

function exportProductsToExcel() {
  const rows = PRODUCTS.map(p => ({
    'SKU': p['SKU'] || '',
    'Name (EN)': p['Description EN (BC)'] || '',
    'Description': p['Description 2 (BC)'] || '',
    'SE Description': p['Not in use Description SE (BC)'] || '',
    'Actual Lumen': p['Actual lumen'] || '',
    'Consumption (W)': p['Consumption'] || '',
    '1 LUX @ m': p['1 LUX @ m'] || ''
  }));
  const ws = XLSX.utils.json_to_sheet(rows);
  ws['!cols'] = [{ wch: 18 }, { wch: 35 }, { wch: 40 }, { wch: 40 }, { wch: 14 }, { wch: 16 }, { wch: 12 }];
  const wb = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb, ws, 'Strand Products');
  XLSX.writeFile(wb, 'strand_products.xlsx');
}

// â”€â”€ PRODUCT LOOKUP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function findProduct(query) {
  const q = query.toLowerCase().trim();
  // Exact SKU match
  let match = PRODUCTS.find(p => p.SKU && p.SKU.toLowerCase() === q);
  if (match) return match;
  // Partial SKU match
  match = PRODUCTS.find(p => p.SKU && q.includes(p.SKU.toLowerCase()));
  if (match) return match;
  // Search across all text fields
  match = PRODUCTS.find(p => {
    const allText = Object.values(p).join(' ').toLowerCase();
    return allText.includes(q) && q.length > 3;
  });
  return match || null;
}

function formatProductAnswer(p) {
  const name = p['Description EN (BC)'] || p['Not in use Description SE (BC)'] || 'Unknown product';
  const desc = p['Description 2 (BC)'];
  const lumen = p['Actual lumen'];
  const consumption = p['Consumption'];
  const range = p['1 LUX @ m'];

  let html = `ğŸ“¦ <strong>SKU: ${p.SKU}</strong>\n`;
  html += `ğŸ”¹ <strong>${name}</strong>\n`;
  if (desc) html += `ğŸ“ ${desc}\n`;
  if (lumen) html += `ğŸ’¡ Actual lumen: <strong>${lumen} lm</strong>\n`;
  if (consumption) html += `âš¡ Power consumption: <strong>${consumption} W</strong>\n`;
  if (range) html += `ğŸ“ Range (1 LUX): <strong>${range} m</strong>\n`;

  // Detect stripped HTML description
  if (p['Produktbeskrivning ENG (HTML)']) {
    const stripped = p['Produktbeskrivning ENG (HTML)'].replace(/<[^>]+>/g, ' ').replace(/\s+/g, ' ').trim().slice(0, 300);
    if (stripped.length > 20) html += `\nğŸ“‹ ${stripped}...`;
  }

  html += `\n\nğŸ” Search this product on <a href="https://strandseurope.com/en/?search=${encodeURIComponent(p.SKU)}" target="_blank">strandseurope.com â†’</a>`;
  return html;
}

// â”€â”€ CATEGORY TABS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const categoryQuestions = {
  all: ['Tell me about 809456','What is lumen and lux?','Do I need CAN bus?','How long is the warranty?','What is IP rating?','How do I contact support?','Tell me about NUUK D-LINE'],
  product: ['Tell me about 809456XBB','Tell me about 901036','Tell me about 907055','Tell me about SIBERIA LED BAR','Tell me about 809212A','Tell me about 270494','What light should I choose?'],
  tech: ['What is lumen and lux?','What is Kelvin?','What are beam patterns?','What are ECE regulations?','What is IP rating?','What amp rating do I need?','What are light technology types?'],
  order: ['Is there a minimum order?','How long is delivery?','How do I track my order?','I received the wrong product','Items missing from my order','Do you offer express delivery?'],
  warranty: ['How long is the warranty?','My product has broken','Does warranty cover modifications?','Can I cut the cable?','Can I cut the DT connector?','I want to return a product'],
  canbus: ['Do I need a CAN bus interface?','Will XBB work with my new car?','Do I need resistors for LED taillights?','What happens after a software update?','Will high beam automatics work?'],
  contact: ['How do I contact support?','How do I become a reseller?','What are your opening hours?']
};

function setCategory(cat, btn) {
  document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
  btn.classList.add('active');
  const qs = categoryQuestions[cat] || categoryQuestions.all;
  const sugg = document.getElementById('suggestions');
  sugg.style.display = 'flex';
  sugg.innerHTML = qs.map(q => `<button class="suggestion-btn" onclick="ask(this)">${q}</button>`).join('');
}

// â”€â”€ FAQ KNOWLEDGE BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FAQ = [
  { cat:'tech', keywords:['light technology','halogen','xenon','led','types of lights','kind of technology','what technology'], answer:`The most common types are halogen, xenon, and LED:\n\nğŸ’¡ Halogen â€” Uses halogen gas and a filament. Brighter than regular bulbs but less luminous and shorter lifespan than xenon or LED. Generates significant heat.\n\nğŸ’¡ Xenon â€” Contains xenon gas, no filament. Longer lifespan, less power consumption than halogen.\n\nğŸ’¡ LED â€” The most modern technology used in most Strands products:\nâ€¢ Very long lifespan\nâ€¢ Low power consumption\nâ€¢ Short ignition time\nâ€¢ Better resistance to vibrations\n\nğŸ”— <a href="https://strands.se/kunskapsbank/valj-ratt-extraljus-den-ultimata-guiden/" target="_blank">Read more in our knowledge bank â†’</a>` },
  { cat:'tech', keywords:['lumen','lux','light output','brightness','intensity','luminous'], answer:`Lumen and lux explained:\n\nğŸ“ Lumen â€” Measures luminous flux (strength) from a light source. Strands always refers to actual lumens â€” not theoretical values.\n\nğŸ“ Lux â€” Measures illuminance: how much light hits a specific surface. 1 lux = 1 lumen per mÂ². Driving lights often state "1 lux @ x meters". For example: 1 lux @ 700m means 1 lumen/mÂ² at 700 meters.\n\nğŸ”¬ Strands has an advanced light laboratory for accurate measurements.` },
  { cat:'tech', keywords:['kelvin','color temperature','warm','cool','white light','colour'], answer:`Kelvin is a measure of color temperature:\n\nğŸŒ¡ï¸ Higher Kelvin = cooler, bluer light\nğŸŒ¡ï¸ Lower Kelvin = warmer, redder light\n\nFor driving/work lights, cooler color temperature is usually ideal â€” clear, distinct beam.\nWarmer color can be better in rain/snow â€” reduces glare from water particles.` },
  { cat:'tech', keywords:['beam pattern','beam','flood','combo','pencil','optimized','extended','long-distance'], answer:`Strands offers three main beam patterns:\n\nğŸ”¦ Optimized (Flood) â€” Widest beam. Best for winding roads â€” spots hazards on the sides.\nğŸ”¦ Extended (Combo) â€” Combination of width and distance. Versatile all-rounder.\nğŸ”¦ Long-distance (Pencil) â€” Narrow beam with maximum range. Best for highways and mountain roads.` },
  { cat:'tech', keywords:['ece','e-approved','regulations','legal','road legal','approval','r112','r87','r91'], answer:`ECE regulations (E-approved) govern permitted vehicle lights, their intensity, and installation rules.\n\nKey rules:\nâ€¢ Driving light must not be too powerful\nâ€¢ Position lights must have the correct color\nâ€¢ Placement and quantity rules apply\n\nMany Strands lights have two modes: E-mode (approved) and Xperience mode.\n\nECE categories: R3 Reflectors Â· R6 Indicators Â· R7 Position lights Â· R19 Fog lights Â· R65 Warning lights Â· R87 DRL Â· R91 Side markers Â· R112 Headlamps` },
  { cat:'tech', keywords:['ip rating','ip class','ip66','waterproof','dustproof','water protection','ip67','ip69'], answer:`IP rating indicates protection against solids and liquids.\n\nFirst digit (dust): 5=protected, 6=dust-tight\nSecond digit (water): 5=jets, 6=powerful jets, 7=submerged, 8=continuous immersion, 9K=high-pressure/hot\n\nExample: IP66 = dust-tight + powerful water jet protection.\nâš ï¸ Lower IP rating may not withstand car washing.` },
  { cat:'tech', keywords:['relay','fuse','cable','amp','ampere','installation','wire gauge','wiring'], answer:`Relay, fuse, and cable guidelines:\n\nâ€¢ Relay: At least 10% above maximum load â€” higher amp than the fuse.\nâ€¢ Fuse: Just above total maximum load (weakest link by design).\nâ€¢ Cable cross-section: Depends on load, length, and material â€” no universal answer.\n\nâš ï¸ If unsure, consult a vehicle electrician.` },
  { cat:'order', keywords:['minimum order','order limit','minimum','smallest order'], answer:`There is no minimum order limit at Strands. Order as little or as much as you need! ğŸ›’` },
  { cat:'order', keywords:['change order','modify order','cancel order','edit order','update order'], answer:`Orders are processed promptly â€” changes cannot be made once confirmed (including address).\n\nIf your order is not yet confirmed:\nğŸ“ +46(0)320-450450\nâ° 08:00â€“17:00 on business days.` },
  { cat:'order', keywords:['missing item','items missing','missing from order','incomplete order','not all items'], answer:`Missing items in your order?\n\nThe item may be on backorder, or something went wrong during picking.\n\nContact us right away:\nğŸ“§ support@strands.se\nğŸ“ +46(0)320-450450` },
  { cat:'order', keywords:['wrong product','wrong item','incorrect product','received wrong','got wrong'], answer:`We apologize for the mix-up! Contact support immediately:\nğŸ“§ support@strands.se\nğŸ“ +46(0)320-450450\nâ° 08:00â€“17:00 on business days.` },
  { cat:'order', keywords:['track order','tracking','where is my order','follow package','postnord','shipment status'], answer:`Once shipped, you'll receive an email with a tracking link.\n\nYou can also track via the PostNord app or transport company's website.` },
  { cat:'order', keywords:['express delivery','express shipping','fast delivery','urgent delivery','overnight'], answer:`Strands does not currently offer express delivery. We ship via PostNord which does not have an express option.` },
  { cat:'order', keywords:['delivery time','how long','shipping time','when will','estimated delivery'], answer:`Delivery times:\nğŸ‡¸ğŸ‡ª Sweden: Approximately 1â€“4 business days.\nğŸŒ International: Varies by destination.\nğŸ“§ support@strands.se for an estimate.` },
  { cat:'order', keywords:['reseller','become reseller','retailer','dealer','distribute','wholesaler'], answer:`Interested in becoming a Strands reseller?\nğŸ“§ order@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/become-a-retailer" target="_blank">Become a retailer â†’</a>` },
  { cat:'warranty', keywords:['warranty','guarantee','how long warranty','warranty period','years warranty'], answer:`Strands Lighting Division (SLD) products: 3 to 6-year warranty depending on product.\nOther product ranges: typically 1 year.\n\nCovers defects from production/manufacturing â€” NOT incorrect use or installation.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Full warranty terms â†’</a>` },
  { cat:'warranty', keywords:['product broken','broken','stopped working','not working','make a claim','warranty claim'], answer:`Product broken?\nâ€¢ If from a retailer â†’ contact the retailer directly.\nâ€¢ Direct claim with Strands:\nğŸ“§ reklamation@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Claims & returns â†’</a>` },
  { cat:'warranty', keywords:['return','regret','cancel','right of withdrawal','ordered wrong'], answer:`Right of withdrawal does not apply to B2B transactions. Company orders are binding.\n\nHowever, Strands is solution-oriented â€” contact us early and we'll try to help.\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Claims & returns â†’</a>` },
  { cat:'warranty', keywords:['modify product','modification','warranty void','tamper','disassemble','opened product','open lamp'], answer:`Opening or modifying a sealed product voids the warranty.\n\nâœ… If product is designed to be opened (e.g. halogen light for bulb replacement) â€” warranty maintained.\nâŒ Opening a sealed LED bar â€” warranty expires.\n\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Warranty terms â†’</a>` },
  { cat:'warranty', keywords:['cut dt connector','dt connector','dt plug'], answer:`The warranty does NOT apply if you cut the DT connector.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Warranty terms â†’</a>` },
  { cat:'warranty', keywords:['cut cable','shorten cable','cable length','cut wire'], answer:`Warranty does not apply if you cut the cable shorter than 50 cm.\nğŸ”— <a href="https://strandseurope.com/sv/about-us/function-warranty" target="_blank">Warranty terms â†’</a>` },
  { cat:'canbus', keywords:['canbus interface','can bus','270417','when do i need','need interface','canbuss'], answer:`When do you need a CAN bus interface (Part No. 270417)?\n\nYou need it when connecting an LED bar/driving lights to high beam, AND your vehicle only delivers a current pulse (not constant power) to activate the high beam.\n\nâ€¢ Direct connection to battery with separate panel: no CAN bus issue\nâ€¢ If using high beam as trigger signal for relay: CAN bus interface needed\n\nMainly needed for vehicles with xenon or LED headlamps.` },
  { cat:'canbus', keywords:['high beam automatic','adaptive high beam','auto high beam'], answer:`Adaptive/automatic high beam will NOT work with the CAN bus interface (Part No. 270417).\n\nIt will still function in manual high beam mode.` },
  { cat:'canbus', keywords:['software update','car update','firmware car','workshop update'], answer:`If your car's software is updated, the CAN bus system may use a new signal.\n\nâ€¢ The interface will stop working and needs updating through Nitor.\nâ€¢ If more than 12 months old, it may need to be replaced.` },
  { cat:'canbus', keywords:['resistor','led taillights','tail light','error message led','load resistor'], answer:`Do you need resistors for LED taillights?\n\nIt depends on your car:\nâ€¢ Some cars work fine without resistors.\nâ€¢ Others won't activate the light without one (tricks the car's computer into detecting a bulb).\nâ€¢ Newer/higher-end cars are more sensitive.\n\nğŸ’¡ Try without a resistor first. If the light doesn't work correctly, purchase a resistor.` },
  { cat:'canbus', keywords:['xbb dongle','will xbb work','xbb new car','obd port locked','firewall obd','secure gateway','pp-can','270425','907003'], answer:`Will XBB Dongle work with your new car?\n\n1. Check the Recipe (compatible vehicle list):\nğŸ”— <a href="https://www.xbb.se/xbbTable/bilmodeller.php" target="_blank">Compatible car list â†’</a>\n\n2. OBD Port accessibility:\nSome newer vehicles (Volvo post-2017, some Mercedes, newer VAG) have a "firewall" on the OBD port.\n\nSolutions:\nâ€¢ Standard: XBB Dongle/PowerUnit kit (270425) + wiring harness (907003)\nâ€¢ Locked OBD port: PP-CAN + wiring (907051 + 907052)\nâ€¢ No OBD port: PP-CAN-FD â€” connects directly to CAN bus\n\nğŸ’¡ Contact Strands with your registration number:\nğŸ“§ support@strands.se` },
  { cat:'canbus', keywords:['how to use xbb','xbb setup','xbb install','configure xbb','xbb configurator'], answer:`How to use XBB / CAN bus interface:\n\n1. Check compatible recipe for your car:\nğŸ”— <a href="https://www.xbb.se/en/compatible-cars/" target="_blank">Compatible cars â†’</a>\n2. Download XBB Configurator app\n3. Connect XBB Dongle to OBD2 port\n4. Pair in app and select a recipe\n5. Test signals\n6. Install lights and XBB PowerUnit with correct wiring\n7. Connect to PowerUnit in app\n8. Start car and test lights\n\nğŸ”— <a href="https://www.xbb.se/en/snabbguide/" target="_blank">Full installation guide â†’</a>` },
  { cat:'product', keywords:['which light','which driving light','choose light','right light','light for my car','suitable light','what light'], answer:`Choosing the right driving light:\n\nğŸš› Large car/truck â†’ 9" driving light or larger LED bar\nğŸš LCV/regular car â†’ 7" driving light or slim LED bar\n\nBeam patterns:\nâ€¢ Long straight roads â†’ Long-distance/pencil beam\nâ€¢ Winding forest/country roads â†’ Optimized/flood\nâ€¢ All-round â†’ Extended/combo\n\nğŸ”— <a href="https://strandseurope.com" target="_blank">Browse Strands products â†’</a>` },
  { cat:'product', keywords:['no-glare','noglare','glare','blinding','for9t'], answer:`No-Glare technology (featured in FOR9T):\n\nThe unique lens divides light output:\nâ€¢ Stronger in the lower part of the beam\nâ€¢ More diffused further up\n\nPrevents tired eyes from glare while providing maximum forward visibility.` },
  { cat:'product', keywords:['e-mode','xperience mode','two modes','light modes','road legal mode'], answer:`E-mode vs Xperience mode:\n\nâœ… E-mode â€” E-approved and road legal. Significant boost to high beam. Better in rain/snow â€” less glare from water.\n\nâš¡ Xperience mode â€” Maximum power mode. Most impressive output in terms of luminosity and range. Optimal for very dark conditions.` },
  { cat:'product', keywords:['repair','repairs','fix product','service product'], answer:`Strands does not offer product repairs.\n\nMost products are sealed from the factory. If your product has a fault:\nğŸ“§ reklamation@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/contact/claims-and-returns" target="_blank">Claims & returns â†’</a>` },
  { cat:'product', keywords:['manual','instruction','user guide','find manual','product manual','documentation'], answer:`Download the product manual from the product page on strandseurope.com.\n\nIf you can't find it:\nğŸ“§ support@strands.se` },
  { cat:'product', keywords:['spare parts','replacement parts','spare','parts available'], answer:`Strands can sometimes offer spare parts and mounting accessories.\n\nğŸ“§ support@strands.se\nğŸ”— <a href="https://strandseurope.com/sv/kategorier/monteringstillbehor/fasten" target="_blank">Browse mounting accessories â†’</a>` },
  { cat:'product', keywords:['condensation','moisture','water inside lamp','fog inside','water in light'], answer:`Condensation inside a lamp is normal â€” caused by humidity and temperature changes.\n\nMost Strands lights have a breather vent. The moisture will dissipate through this vent when you use the lamp â€” no action needed.` },
  { cat:'product', keywords:['where install','placement','install lights','position lights','where to mount','height'], answer:`For maximum visibility, install lights as high as possible on the vehicle:\nâ€¢ Less shadows on the road\nâ€¢ Fewer "dark spots"\nâ€¢ Better overall light experience` },
  { cat:'contact', keywords:['contact','support','phone','email','reach','get in touch','customer service','help','opening hours'], answer:`Strands contact information:\n\nğŸ“ Phone: +46(0)320-450450\nğŸ“§ Customer service: order@strands.se\nğŸ“§ Technical support: support@strands.se\nğŸ“§ Warranty claims: reklamation@strands.se\n\nğŸ• Opening hours: 08:00â€“17:00 on business days\nEmails answered within 24 hours on business days.\n\nğŸ¢ Strands Group AB, HagalundsvÃ¤gen, 51172 Fritsla, Sweden` },
  { cat:'contact', keywords:['images','photos','copyright','use images','use text','website content','permission'], answer:`All content on the Strands website is owned by Strands or used with permission, and is copyright protected.\n\nCopying images or materials without Strands' prior consent is forbidden. Please contact us first:\nğŸ“§ support@strands.se` }
];

// â”€â”€ MATCHING ENGINE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function findAnswer(query) {
  const q = query.toLowerCase();

  // Check if asking about product listing/export
  if (q.includes('export') && (q.includes('product') || q.includes('list') || q.includes('excel'))) {
    exportProductsToExcel();
    return `ğŸ“¥ I've exported the full product list to Excel! Check your downloads folder.\n\nThe file contains all ${PRODUCTS.length} SKUs with names, descriptions, lumen output, consumption, and range data.`;
  }

  // Check for product-related query by SKU or product name
  if (q.match(/\b\d{5,}\b/) || q.includes('sku') || q.match(/[A-Z]{2,}\d{4,}/) || PRODUCTS.some(p => p.SKU && q.includes(p.SKU.toLowerCase()))) {
    const product = findProduct(query);
    if (product) {
      return formatProductAnswer(product);
    }
  }

  // Try name-based product search
  const nameTerms = ['nuuk','siberia','big energy','firefly','cruise light','iZE','xbb','pp-can','relay box','beacon','freedom work','scene work','portable work'];
  for (const term of nameTerms) {
    if (q.includes(term)) {
      const product = findProduct(term);
      if (product) return formatProductAnswer(product);
    }
  }

  // FAQ matching
  let bestMatch = null, bestScore = 0;
  for (const faq of FAQ) {
    let score = 0;
    for (const kw of faq.keywords) {
      if (q.includes(kw.toLowerCase())) score += kw.split(' ').length;
    }
    if (score > bestScore) { bestScore = score; bestMatch = faq; }
  }

  if (bestScore > 0) return bestMatch.answer;

  // No answer found â€” log and offer export
  logUnanswered(query);
  return `I couldn't find a specific answer to that question.\n\nğŸ“§ <a href="mailto:support@strands.se">support@strands.se</a>\nğŸ“ +46(0)320-450450\nğŸ”— <a href="https://strandseurope.com" target="_blank">strandseurope.com â†’</a>\n\nYour question has been logged. <button class="download-btn" onclick="exportUnansweredToExcel()">ğŸ“¥ Download unanswered questions</button>`;
}

// â”€â”€ CHAT UI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function addMessage(role, html, extraHTML) {
  const messages = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = `message ${role}`;

  const avatarLabel = role === 'bot' ? 'STR\nAND' : 'You';
  div.innerHTML = `
    <div class="avatar ${role}-avatar" style="white-space:pre-line">${avatarLabel}</div>
    <div class="bubble">${html.replace(/\n/g, '<br>')}${extraHTML ? '<br>' + extraHTML : ''}</div>
  `;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function showTyping() {
  const messages = document.getElementById('messages');
  const div = document.createElement('div');
  div.className = 'message bot'; div.id = 'typing';
  div.innerHTML = `<div class="avatar bot-avatar" style="white-space:pre-line;font-size:9px">STR\nAND</div><div class="bubble"><div class="dots"><span></span><span></span><span></span></div></div>`;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}

function removeTyping() {
  const t = document.getElementById('typing');
  if (t) t.remove();
}

function ask(btn) {
  document.getElementById('userInput').value = btn.textContent;
  sendMessage();
}

function sendMessage() {
  const input = document.getElementById('userInput');
  const text = input.value.trim();
  if (!text) return;
  document.getElementById('suggestions').style.display = 'none';
  addMessage('user', text);
  input.value = '';
  showTyping();
  setTimeout(() => {
    removeTyping();
    const answer = findAnswer(text);
    addMessage('bot', answer);
  }, 400 + Math.random() * 250);
}

window.onload = () => {
  setTimeout(() => {
    addMessage('bot', `Hi! ğŸ‘‹ I'm the STRAND FAQ & Product Assistant.\n\nI can help you with:\nâ€¢ ğŸ“¦ Product lookup by SKU or name (${PRODUCTS.length} products loaded)\nâ€¢ ğŸ’¡ Light technology (lumen, lux, Kelvin, ECE, IP rating)\nâ€¢ ğŸ›’ Orders, delivery & returns\nâ€¢ ğŸ›¡ï¸ Warranty & claims\nâ€¢ ğŸ”Œ CAN bus & XBB installation\n\nUnanswered questions are automatically logged and you can export them as an Excel file.\n\nTry asking: "Tell me about SKU 809456" or "What is lumen?"`);
  }, 400);
};
</script>
</body>
</html>
